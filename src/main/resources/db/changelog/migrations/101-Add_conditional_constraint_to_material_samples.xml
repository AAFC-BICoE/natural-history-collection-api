<?xml version="1.1" encoding="UTF-8" standalone="no" ?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog db/changelog/xsd/dbchangelog-4.4.xsd"
                   objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

  <changeSet id="101-Add_conditional_constraint_to_material_samples" context="schema-change" author="Brandon Andre">
    <addColumn tableName="material_sample">
      <column name="allow_duplicate_name" type="boolean" defaultValueBoolean="false"/>
    </addColumn>

    <!-- Liquibase does not support partial unique indexes (with the WHERE statement) -->
    <sql>
      CREATE UNIQUE INDEX unique_material_sample_name
      ON collection.material_sample(material_sample_name)
      WHERE allow_duplicate_name IS FALSE;
    </sql>
  </changeSet>

</databaseChangeLog>